<h6 class="card-title text-muted">Pagos</h6>

<div class="row" *ngIf="!showForm && !showPeopleForm">
    <div class="col-12">
        <div class="text-center" *ngIf="reservation.reservation_state_id != 4">
            <button mat-button color="primary" (click)="showForm = true">
                <mat-icon>add</mat-icon> Nuevo pago
            </button>
        </div>

        <div *ngIf="reservationPayments.length == 0" class="text-center mt-4">
            <p>Ningun pago registrado.</p>
        </div>

        <ul class="list-group list-group-flush" *ngIf="reservationPayments.length > 0">
            <li class="list-group-item py-2" *ngFor="let item of reservationPayments; let i = index">
                <div *ngIf="item.payment_by == 0" class="font-weight-bold text-muted">Pago por habitaciones</div>                
                <div *ngIf="item.payment_by == 1" class="font-weight-bold text-muted">Pago por consumo</div>                
                <div *ngIf="item.payment_by == 2" class="font-weight-bold text-muted">Pago por habitaciones y consumo</div> 
                <div class="d-flex justify-content-between">
                    <p class="font-weight-bold text-muted">{{item.total | currency:item.currency.symbol}}</p>
                    <p>{{item.created_at | date:'dd MMM y HH:mm'}}</p>
                </div>
            </li>
        </ul>
    </div>
</div>

<form [formGroup]="form" *ngIf="showForm" novalidate autocomplete="off">
    <div class="row">
        <div class="col-12 mb-2">
            <div class="d-flex justify-content-between w-100 align-items-center">
                <div class="card-text d-flex align-items-center">
                    <mat-icon>person</mat-icon>
                    {{peopleFullName | titlecase}}
                </div>
                <div>
                    <button mat-icon-button color="primary" matTooltip="Ver datos de cliente" (click)="showForm = false; showPeopleForm = true">
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Método de pago</mat-label>
                <mat-select formControlName="payment_method_id">
                    <mat-option *ngFor="let item of paymentMethods" [value]="item.id">{{item.name}}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-12 col-md-3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Monto</mat-label>
                <input matInput type="number" formControlName="total" min="1">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Paga con</mat-label>
                <input matInput type="number" formControlName="payment_amount">
            </mat-form-field>
        </div>
        <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Descripción</mat-label>
                <input matInput formControlName="description">
            </mat-form-field>
        </div>
        <div class="col-12 mb-3">
            <mat-checkbox color="primary" class="m-2" formControlName="print_payment">Generar impresión</mat-checkbox>
            <mat-checkbox color="primary" class="m-2" formControlName="payment_by_reservation">Pago por alquiler</mat-checkbox>
            <mat-checkbox color="primary" class="m-2" formControlName="payment_by_products">Pago por consumo</mat-checkbox>
        </div>
        <div class="col-12">
            <div class="d-flex justify-content-between my-2">
               <p class="card-text font-weight-bold my-0">Subtotal</p>
               <p class="card-text my-0">{{subtotal | currency:baseCurrency.symbol}}</p>
            </div>
            <div class="d-flex justify-content-between my-2">
               <p class="card-text font-weight-bold my-0">IGV (18%)</p>
               <p class="card-text my-0">{{taxValue | currency:baseCurrency.symbol}}</p>
            </div>
            <div class="d-flex justify-content-between my-2">
               <p class="card-text font-weight-bold my-0">Total</p>
               <p class="card-text my-0">{{total | currency:baseCurrency.symbol}}</p>
            </div>
            <div class="d-flex justify-content-between my-2" *ngIf="paymentBack > 0">
               <p class="card-text font-weight-bold my-0">Vuelto</p>
               <p class="card-text my-0">{{paymentBack | currency:baseCurrency.symbol}}</p>
            </div>
        </div>
        <div class="col-12">
            <div class="row">
                <div class="col">
                    <button type="button" (click)="onSubmit('not')" [disabled]="form.invalid" class="w-100 m-1" mat-flat-button color="primary">
                        Nota de venta
                    </button>
                </div>
                <div class="col">
                    <button type="button" (click)="onSubmit('bol')" [disabled]="form.invalid" class="w-100 m-1" mat-flat-button color="primary">
                        Boleta
                    </button>
                </div>
                <div class="col">
                    <button type="button" (click)="onSubmit('fac')" [disabled]="form.invalid" class="w-100 m-1" mat-flat-button color="primary">
                        Factura
                    </button>
                </div>
                <div class="col">
                    <button type="button" class="w-100 m-1" mat-button color="primary" (click)="showForm = false; showPeopleForm = false">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<form [formGroup]="peopleForm" (ngSubmit)="onSubmitPeople()" *ngIf="showPeopleForm" novalidate autocomplete="off">
    <div class="row">
        <div class="col-12 col-md-6 pr-1">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Tipo Doc.</mat-label>
                <mat-select formControlName="document_type_id">
                    <mat-option *ngFor="let item of documentTypes" [value]="item.id">{{item.name}}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1 pl-0">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>N° Doc.</mat-label>
                <input matInput formControlName="document_number" (keydown.enter)="$event.preventDefault()">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-12 pr-1" *ngIf="peopleForm.controls['document_type_id'].value == 3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Raz. Social</mat-label>
                <input matInput formControlName="full_name">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1" *ngIf="peopleForm.controls['document_type_id'].value != 3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Nombres</mat-label>
                <input matInput formControlName="name">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1 pl-0" *ngIf="peopleForm.controls['document_type_id'].value != 3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Apellidos</mat-label>
                <input matInput formControlName="last_name">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1" *ngIf="peopleForm.controls['document_type_id'].value != 3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Genero.</mat-label>
                <mat-select formControlName="gender_id">
                    <mat-option *ngFor="let item of genders" [value]="item.id">{{item.name}}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1 d-none" [ngClass]="{'pl-0': peopleForm.controls['document_type_id'].value != 3}">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Telf.</mat-label>
                <input matInput formControlName="phone_number">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1" [ngClass]="{'pl-0': peopleForm.controls['document_type_id'].value != 3, 'col-md-12' : peopleForm.controls['document_type_id'].value == 3}">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Correo</mat-label>
                <input matInput formControlName="email">
            </mat-form-field>
        </div>
        <div class="col-12 col-md-6 pr-1 pl-0 d-none" *ngIf="peopleForm.controls['document_type_id'].value != 3">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Cumpleaños</mat-label>
                <input matInput [matDatepicker]="birthdayPicker" formControlName="birthday_date" disabled>
                <mat-datepicker-toggle matSuffix [for]="birthdayPicker"></mat-datepicker-toggle>
                <mat-datepicker #birthdayPicker disabled="false"></mat-datepicker>
            </mat-form-field>
        </div>
        <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Dirección</mat-label>
                <input matInput formControlName="address">
            </mat-form-field>
        </div>
        <div class="col-12"></div>
        <div class="col-6">
            <button class="btn-block" type="button" mat-button color="primary" (click)="showForm = true; showPeopleForm = false">
                Cancelar
            </button>
        </div>
        <div class="col-6">
            <button class="btn-block" [disabled]="peopleForm.invalid" type="submit" mat-flat-button color="primary">
                <mat-icon>save</mat-icon> Guardar
            </button>
        </div>

    </div>
</form>