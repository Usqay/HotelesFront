<div class="sale-container">
    <div class="row pt-4 h-100">
        <div class="col-12 col-md-6 col-lg-7">
            <div class="card m-0 rounded-sm h-100">
                <div class="card-body p-3 pl-4">
                    <app-sale-products *ngIf="!showPayment && !showConsumption" (onAddProduct)="onAddProduct($event)" (onAddService)="onAddService($event)">
                    </app-sale-products>
                    <div class="row" *ngIf="showPayment || showConsumption">
                        <div class="col-12" *ngIf="showPayment">
                            <app-sale-payment-form [total]="totalPrice" (onCancel)="showPayment = !showPayment" (onSubmit)="payment = $event; onSubmitWithPayment()"></app-sale-payment-form>
                        </div>
                        <div class="col-12" *ngIf="showConsumption">
                            <app-consumption-form [total]="totalPrice" (onCancel)="showConsumption = !showConsumption" (onSubmit)="reservationRoom = $event; onSubmitWithConsumption()"></app-consumption-form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-lg-5 h-100 d-flex align-content-between flex-wrap">
            <div class="card mb-1 rounded-sm shadow-none w-100 items-container">
                <div class="card-body px-2 pt-0">
                    <mat-tab-group>
                        <mat-tab label="Ítems">
                            <div class="text-center mt-3" *ngIf="items.length == 0">
                                <mat-icon>widgets</mat-icon>
                                <p class="card-text">
                                    Ningún ítem seleccionado
                                </p>
                            </div>

                            <ul class="list-group list-group-flush mt-3">
                                <li class="list-group-item pl-2" [ngClass]="{'active-panel': item == activeItem}"
                                    *ngFor="let item of items; let i = index">
                                    <div *ngIf="item != activeItem">
                                        <p class="mb-0 cursor-pointer font-weight-bold" (click)="activeItem = item"
                                            *ngIf="item.product != null && !showPayment && !showConsumption">{{item.product.name | titlecase}}</p>
                                        <p class="mb-0 cursor-pointer font-weight-bold" (click)="activeItem = item"
                                            *ngIf="item.service != null && !showPayment && !showConsumption">{{item.service.name | titlecase}}</p>
                                        <p class="mb-0 cursor-pointer font-weight-bold"
                                            *ngIf="item.product != null && (showPayment || showConsumption)">{{item.product.name | titlecase}}</p>
                                        <p class="mb-0 cursor-pointer font-weight-bold"
                                            *ngIf="item.service != null && (showPayment || showConsumption)">{{item.service.name | titlecase}}</p>
                                        <div class="d-flex w-100 justify-content-between align-items-center">
                                            <small class="text-muted">
                                                Cant.: <strong>{{item.quantity}}</strong>
                                            </small>
                                            <small class="text-muted">P. unitario:
                                                <strong>{{item.price | currency:item.currency.symbol}}</strong>
                                            </small>
                                            <small class="text-muted">P. total:
                                                <strong>{{calculateTotalPrice(item) | currency:item.currency.symbol}}</strong>
                                            </small>
                                            <button mat-icon-button color="accent" *ngIf="!showPayment && !showConsumption" (click)="deleteItem(i)">
                                                <mat-icon>delete</mat-icon>
                                            </button>
                                        </div>
                                        <small class="text-muted" *ngIf="item.rateValue != 1">T. cambio: <strong>{{item.rateValue | currency : baseCurrency.symbol}}</strong></small>
                                    </div>
                                    <div class="row my-2" *ngIf="item == activeItem">
                                        <div class="col-12">
                                            <p class="mb-2 cursor-pointer font-weight-bold" (click)="activeItem = null"
                                                *ngIf="item.product != null">{{item.product.name | titlecase}}</p>
                                            <p class="mb-2 cursor-pointer font-weight-bold" (click)="activeItem = null"
                                                *ngIf="item.service != null">{{item.service.name | titlecase}}</p>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="input-group input-group-sm">
                                                <div class="input-group-prepend">
                                                    <button class="btn btn-secondary" type="button"
                                                        matTooltip="Disminuir" (click)="incrementOrDecrement(item)">
                                                        <i class="fa fa-minus"></i>
                                                    </button>
                                                </div>
                                                <input type="text" class="form-control" (keyup)="calculateTotals()" [(ngModel)]="item.quantity"
                                                    matTooltip="Cantidad">
                                                <div class="input-group-append">
                                                    <button class="btn btn-secondary" type="button"
                                                        matTooltip="Incrementar"
                                                        (click)="incrementOrDecrement(item, true)">
                                                        <i class="fa fa-plus"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="input-group input-group-sm">
                                                <div class="input-group-prepend">
                                                    <button class="btn btn-primary" readonly type="button"
                                                        [matTooltip]="item.currency.plural_name">
                                                        {{item.currency.symbol}}
                                                    </button>
                                                </div>
                                                <input type="number" min="0.1" step="any" (keyup)="calculateTotals()" class="form-control" [(ngModel)]="item.price"
                                                    matTooltip="Precio">
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </mat-tab>
                        <mat-tab label="Cliente" *ngIf="!showConsumption">
                            <app-sale-client-form (people)="people = $event"></app-sale-client-form>
                        </mat-tab>
                    </mat-tab-group>
                </div>
            </div>
            <div class="card my-0 rounded-sm shadow-none w-100 total">
                <div class="card-body p-3 d-flex align-content-between flex-wrap">
                    <div class="w-100">
                        <div *ngIf="totalPrice > 0" class="d-flex w-100 alig-items-center justify-content-between">
                            <p class="my-0 card-text font-weight-bold">Total a pagar en {{baseCurrency.plural_name}}</p>
                            <p class="my-0 card-text">{{totalPrice | currency:baseCurrency.symbol}}</p>
                        </div>
                        <div class="row mt-2">
                            <div class="col" *ngIf="!showPayment && !showConsumption" >
                                <button mat-flat-button class="w-100" [disabled]="totalPrice == 0" color="primary" (click)="onPayment()">Pagar</button>
                            </div>
                            <div class="col" *ngIf="!showPayment && !showConsumption" >
                                <button mat-button class="w-100" [disabled]="totalPrice == 0" color="primary" (click)="onConsumption()">Consumo</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>